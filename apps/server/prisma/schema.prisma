generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum TeamType {
  PERSONAL
  GROUP
}

model user {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email String @unique
  nickname String?
  profileImage    String? @map("image_url")
  description String?
  isUse       Boolean   @default(true) @map("is_use")
  createdAt   DateTime  @default(now()) @db.Timestamptz(6) @map("created_at")
  updatedAt   DateTime  @default(now()) @db.Timestamptz(6) @map("updated_at")
  deletedAt   DateTime? @db.Timestamptz(6) @map("deleted_at")
  currentRefreshToken String?
  socialAccounts socialAccount[]
  project                     project[]
  taskAssigneeIdTouser task[]         @relation("task_assignee_idTouser")
  taskOwnerIdTouser    task[]         @relation("task_owner_idTouser")
  team                        team[]
  teamMembers                team_members[]
  projectMembers project_members[]
}

model socialAccount{
  id String @id @default(uuid())
  provider String
  providerId String
  userId String @db.Uuid @map("user_id")
  user user @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([provider,providerId])
}



/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model project {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  teamId       String    @map("team_id") @db.Uuid
  ownerId      String    @map("owner_id") @db.Uuid 
  title         String
  profileImage String?   @map("profile_image")
  status        String?   @default("ACTIVE")
  description   String?
  isUse        Boolean        @default(true) @map("is_use")
  createdAt    DateTime       @default(now()) @db.Timestamptz(6) @map("created_at")
  updatedAt    DateTime       @default(now()) @db.Timestamptz(6) @map("updated_at")
  deletedAt    DateTime?      @db.Timestamptz(6) @map("deleted_at")
  owner        user      @relation(fields: [ownerId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  team         team      @relation(fields: [teamId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  task         task[]
  projectMembers project_members[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model task {
  id                          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  projectId                  String    @db.Uuid @map("project_id")
  ownerId                    String    @db.Uuid @map("owner_id")
  assigneeId                 String    @db.Uuid @map("assignee_id")
  title                       String
  content                     String
  status                      String?   @default("ACTIVE")
  priority                    String  @default("5") 
  duedate                     DateTime  @db.Timestamptz(6)
  description                 String?
  isUse        Boolean        @default(true) @map("is_use")
  createdAt    DateTime       @default(now()) @db.Timestamptz(6) @map("created_at")
  updatedAt    DateTime       @default(now()) @db.Timestamptz(6) @map("updated_at")
  deletedAt    DateTime?      @db.Timestamptz(6) @map("deleted_at")
  assignee user      @relation("task_assignee_idTouser", fields: [assigneeId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  owner    user      @relation("task_owner_idTouser", fields: [ownerId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  project                     project   @relation(fields: [projectId], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model team {
  id           String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name         String
  profileImage    String? @map("image_url")
  ownerId     String         @db.Uuid @map("owner_id")
  description  String?
  isUse        Boolean        @default(true) @map("is_use")
  teamType  TeamType @default(GROUP) @map("team_type")
  createdAt    DateTime       @default(now()) @db.Timestamptz(6) @map("created_at")
  updatedAt    DateTime       @default(now()) @db.Timestamptz(6) @map("updated_at")
  deletedAt    DateTime?      @db.Timestamptz(6) @map("deleted_at")
  project      project[]
  owner        user           @relation(fields: [ownerId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  teamMembers team_members[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model team_members {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  teamId     String    @db.Uuid @map("team_id")
  userId     String    @db.Uuid @map("user_id")
  role        String?   @default("MEMBER")
  description String?
  isUse       Boolean   @default(true) @map("is_use")
  createdAt   DateTime  @default(now()) @db.Timestamptz(6) @map("created_at")
  updatedAt   DateTime  @default(now()) @db.Timestamptz(6) @map("updated_at")
  deletedAt   DateTime? @db.Timestamptz(6) @map("deleted_at")
  team        team      @relation(fields: [teamId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user        user      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  @@unique([teamId,userId])
}

model project_members {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  projectId String @db.Uuid @map("project_id")
  userId String @db.Uuid @map("user_id")
  role String? @default("MEMBER")
  description String?
  isUse Boolean @default(true) @map("is_use")
  createdAt DateTime @default(now()) @db.Timestamptz(6) @map("created_at")
  updatedAt DateTime @default(now()) @db.Timestamptz(6) @map("updated_at")
  deletedAt DateTime? @db.Timestamptz(6) @map("deleted_at")
  project project @relation(fields: [projectId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user user @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
